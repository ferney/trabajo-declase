var responses = {
	"NOTFOUND" : {
				 "weight" : 0,
				 "responses" : [
						"Queee??!!!!!",
						"mmmmmmm <br>¿disculpa? a que te refieres¡¡¡¡",
						"No estoy segura de entenderte completamente.",
						"¿Puedes reescribir tu inquietud?",
						"¿Tienes mas inquietudes?"
						
					]
				},
	"perdon" : {
				 "weight" : 1,
				 "responses" : ["No hay problema :)"]},
    "hola" : {
				 "weight" : 1,
				 "responses" : ["Cuentame!!!! que informacion necesitas :)"]},
    "siento" : {
				 "weight" : 1,
				 "responses" : ["No hay problema :)"]},
    "quiero" : {
				 "weight" : 1,
				 "responses" : ["Cuentame y con gusto te dire :)"]},
    "saber" : {
				 "weight" : 1,
				 "responses" : ["No hay problema, dime tu inquietud y con gusto dare respuesta!!"]},
   "carrera" : {
				 "weight" : 1,
				 "responses" : ["Si claro, con gusto, mira por el momento la UNISANGIL esta ofreciendo Ingenieria de Sistemas"]}, 
   
   "que modalidad" : {
				 "weight" : 1,
				 "responses" : ["Vale, actualmente la Ingenieria de Sistemas es prescencial en horario nocturrno."]}, 
   "cuesta" : {
				 "weight" : 1,
				 "responses" : ["Ok, actualmente la Ingenieria de Sistemas tiene un costo de $2.500.000 el semestre y posee 16 creditos academicos."]}, 
    "costo" : {
				 "weight" : 1,
				 "responses" : ["Ok, actualmente la Ingenieria de Sistemas tiene un costo de $2.500.000 el semestre y posee 16 creditos academicos."]}, 
    "vale" : {
				 "weight" : 1,
				 "responses" : ["Ok, actualmente la Ingenieria de Sistemas tiene un costo de $2.500.000 el semestre y posee 16 creditos academicos."]}, 
    "valor" : {
				 "weight" : 1,
				 "responses" : ["Ok, actualmente la Ingenieria de Sistemas tiene un costo de $2.500.000 el semestre y posee 16 creditos academicos."]}, 
     "semestres" : {
				 "weight" : 1,
				 "responses" : ["vale, la Ingenieria de Sistemas en UNISANGIL esta en 10 semestres."]}, 
    "ven" : {
				 "weight" : 1,
				 "responses" : ["vale, no conosco mucho de ello por que soy de administracion, pero se que ven desarrollo android, desarrollo con xamarin, java, php, bueno todo lo de la web, muchas bases de datos y manejo de servidores, desarrollo de software y basante <br>mmm <br> y mucha matematica, muchisima XD."]}, 
      
    
    
    
    
    "como me inscribo" : {
				 "weight" : 1,
				 "responses" : ["vale, Debe consultar las fechas de la convocatoria, luego diríjase a cualquier oficina del Banco Popular y compre un PIN para formulario de inscripción a programas de pregrado presencial de la Universidad de Caldas, para el período vigente. <br><br>El diligenciamiento del PIN puede realizarse luego de su compra, no se requiere tiempo para su activación."]}, 
     "para inscribirme" : {
				 "weight" : 1,
				 "responses" : ["vale, Debe consultar las fechas de la convocatoria, luego diríjase a cualquier oficina del Banco Popular y compre un PIN para formulario de inscripción a programas de pregrado presencial de la Universidad de Caldas, para el período vigente. <br><br>El diligenciamiento del PIN puede realizarse luego de su compra, no se requiere tiempo para su activación."]}, 
    
    
    
    
    
    
    
    "nota se exige" : {
				 "weight" : 1,
				 "responses" : ["vale,No se exige una nota determinada para acceder a los estudios universitarios. Depende del número de plazasque se oferten en cada titulación y de la demanda de plazas que haya de la misma."]},
    "nota exige" : {
				 "weight" : 1,
				 "responses" : ["vale,No se exige una nota determinada para acceder a los estudios universitarios. Depende del número de plazasque se oferten en cada titulación y de la demanda de plazas que haya de la misma."]},
     "notas exige" : {
				 "weight" : 1,
				 "responses" : ["vale,No se exige una nota determinada para acceder a los estudios universitarios. Depende del número de plazasque se oferten en cada titulación y de la demanda de plazas que haya de la misma."]},
     "notas se exigen" : {
				 "weight" : 1,
				 "responses" : ["vale, No se exige una nota determinada para acceder a los estudios universitarios. Depende del número de plazasque se oferten en cada titulación y de la demanda de plazas que haya de la misma."]}, 
    "notas exigen" : {
				 "weight" : 1,
				 "responses" : ["vale, No se exige una nota determinada para acceder a los estudios universitarios. Depende del número de plazasque se oferten en cada titulación y de la demanda de plazas que haya de la misma."]}, 
    
   
     
    "debe tener la foto" : {
				 "weight" : 1,
				 "responses" : ["vale, Para que su foto sea válida debe tener las siguientes características:<br>- Fotografía tipo DOCUMENTO.<br>- Tamaño cédula 3x4<br>- Fondo blanco<br>- En formato JPG<br><br>Esta fotografía será utilizada para la emisión del carnet estudiantil y como imagen en su página de estudiante."]}, 
      
    "como son las fotos" : {
				 "weight" : 1,
				 "responses" : ["vale, Para que su foto sea válida debe tener las siguientes características:<br>- Fotografía tipo DOCUMENTO.<br>- Tamaño cédula 3x4<br>- Fondo blanco<br>- En formato JPG<br><br>Esta fotografía será utilizada para la emisión del carnet estudiantil y como imagen en su página de estudiante."]}, 
    
    
     "fechas de inscripciones" : {
				 "weight" : 1,
				 "responses" : ["vale, Las fechas se publican en el link <br>http://www.utp.edu.co/registro/index.php/informaciongeneral/234/calendario-academico.."]}, 
    "fecha de inscripciones" : {
				 "weight" : 1,
				 "responses" : ["vale, Las fechas se publican en el link <br>http://www.utp.edu.co/registro/index.php/informaciongeneral/234/calendario-academico.."]},
     "fecha de inscripcion" : {
				 "weight" : 1,
				 "responses" : ["vale, Las fechas se publican en el link <br>http://www.utp.edu.co/registro/index.php/informaciongeneral/234/calendario-academico.."]},
    
    
    
    
     "sobre los programas " : {
				 "weight" : 1,
				 "responses" : ["vale, Usted puede ingresar a http://www.utp.edu.co/registro/, link pregrado y consultar los programas que ofrece la universidad con su jornada respectiva o solicitar información en las ventanillas del Centro de Registro y Control Académico."]}, 
    "sobre las carreras " : {
				 "weight" : 1,
				 "responses" : ["vale, Usted puede ingresar a http://www.utp.edu.co/registro/, link pregrado y consultar los programas que ofrece la universidad con su jornada respectiva o solicitar información en las ventanillas del Centro de Registro y Control Académico."]}, 
    
    
    
    
    
    "realizar la inscripción" : {
				 "weight" : 1,
				 "responses" : ["vale, Desde cualquier parte del país donde se encuentre el aspirante, debe tener en cuenta:<br>1. Comprar un pin en el Banco Popular (cuenta empresarial 47003015-6 a nombre de la Universidad Tecnológica de Pereira).<br>2. Ingresar a la página web www.utp.edu.co/inscripciones link Inscripciones en línea para todos los programas en Oferta académica.<br>3. Seleccionar el programa en el cual se va a inscribir y puede escoger un segundo programa para concursar.<br>4. Diligenciar el formulario vía web que contiene información personal (Debe tener a la mano el número AC del registro ICFES).<br>5. Conserve el número PIN para consultar su admisión y la confirmación de la inscripción."]}, 
     "realiza la inscripción" : {
				 "weight" : 1,
				 "responses" : ["vale, Desde cualquier parte del país donde se encuentre el aspirante, debe tener en cuenta:<br>1. Comprar un pin en el Banco Popular (cuenta empresarial 47003015-6 a nombre de la Universidad Tecnológica de Pereira).<br>2. Ingresar a la página web www.utp.edu.co/inscripciones link Inscripciones en línea para todos los programas en Oferta académica.<br>3. Seleccionar el programa en el cual se va a inscribir y puede escoger un segundo programa para concursar.<br>4. Diligenciar el formulario vía web que contiene información personal (Debe tener a la mano el número AC del registro ICFES).<br>5. Conserve el número PIN para consultar su admisión y la confirmación de la inscripción."]}, 
    
    
    
    
    "realiza la admision" : {
				 "weight" : 1,
				 "responses" : ["vale, La Universidad tiene como mecanismo de admisión, el resultado de las pruebas ICFES Saber 11, la selección se realiza de mayor a menor puntaje. Para el programa de Licenciatura en Música realiza una prueba de actitud que equivale al 60% del puntaje de la admisión y el 40% restante corresponde al resultado pruebas ICFES Saber 11.<br>La admisión de la segunda opción fue modificada por la universidad a partir del segundo semestre de 2011. Los aspirantes pueden quedar admitidos en uno o en ambos programas. Si queda admitido en ambos programas, debe elegir uno en el plazo que se indique, de no hacerlo quedará admitido en el programa donde haya tenido el mayor puntaje."]}, 
    "realiza la admisión" : {
				 "weight" : 1,
				 "responses" : ["vale, La Universidad tiene como mecanismo de admisión, el resultado de las pruebas ICFES Saber 11, la selección se realiza de mayor a menor puntaje. Para el programa de Licenciatura en Música realiza una prueba de actitud que equivale al 60% del puntaje de la admisión y el 40% restante corresponde al resultado pruebas ICFES Saber 11.<br>La admisión de la segunda opción fue modificada por la universidad a partir del segundo semestre de 2011. Los aspirantes pueden quedar admitidos en uno o en ambos programas. Si queda admitido en ambos programas, debe elegir uno en el plazo que se indique, de no hacerlo quedará admitido en el programa donde haya tenido el mayor puntaje."]}, 
    "realizar la admisión" : {
				 "weight" : 1,
				 "responses" : ["vale, La Universidad tiene como mecanismo de admisión, el resultado de las pruebas ICFES Saber 11, la selección se realiza de mayor a menor puntaje. Para el programa de Licenciatura en Música realiza una prueba de actitud que equivale al 60% del puntaje de la admisión y el 40% restante corresponde al resultado pruebas ICFES Saber 11.<br>La admisión de la segunda opción fue modificada por la universidad a partir del segundo semestre de 2011. Los aspirantes pueden quedar admitidos en uno o en ambos programas. Si queda admitido en ambos programas, debe elegir uno en el plazo que se indique, de no hacerlo quedará admitido en el programa donde haya tenido el mayor puntaje."]}, 
    
    
    
    
    
    
    
     
    "legalizar mi matrícula" : {
				 "weight" : 1,
				 "responses" : ["vale, Al momento de ser admitido, cada aspirante debe escanear sus documentos de matrícula tanto académica como financiera y adjuntarlos a través del sistema de información en las fechas estipuladas y en el link que se habilite para este trámite.<br><br>Requisitos Académicos<br>Foto reciente 3x4 cm.<br>Copia del documento de identidad actualizado y por ambas caras, en caso de ser extranjero copia de la Cédula de Extranjería y Visa, también por ambas caras.<br>Haber presentado las pruebas ICFES.<br>Fotocopia del Acta de grado; si no se ha graduado, solicite constancia a su colegio donde certifique que cursa el grado 11, y la fecha de la ceremonia de grado; dos días después de la ceremonia debe presentar la fotocopia del acta de grado al Centro de Registro y Control Académico, sin pasarse de la fecha límite que se indica en el plegable de inscripciones para cada periodo académico, para cumplir con lo establecido en el artículo 4 item 1 del Reglamento Estudiantil vigente, de lo contrario pierde el derecho a la matrícula. Si es bachiller extranjero debe presentar Resolución de Convalidación de su título de Bachiller ante el Ministerio de Educación Nacional.<br>Fotocopia del carnet de la EPS o certificado de afiliación.<br><br>Esquema General de Vacunación (Obligatorio).<br>Carnet de vacunación que certifique las siguientes vacunas: BCG, Antipolio, DPT, Hepatitis B, Fiebre Amarilla, Influenza, Triple Viral y Varicela. En caso de no tener el carnet de las anteriores vacunas, diligenciar el acta de exclusión adjunta, si es menor de 18 años dicha acta debe venir firmada por sus padres o acudientes.<br><br>Requisitos Financieros<br>Fotocopia de la Declaración de Renta o del Certificado de ingresos y retenciones percibidos del año inmediatamente anterior (No se recibe certificado de no declarante, ni certificado de ingreso de un solo mes). (En caso de estar exento no es obligatorio).<br>Constancia del colegio original con el valor de la pensión mensual y certificar si es oficial o privado.<br>Fotocopia del último recibo de pago de servicios públicos domiciliarios cancelados donde conste el estrato social.<br>Si usted tiene algún hermano estudiando en esta Universidad debe adjuntar los registros civiles de cada uno.<br>Copia del certificado electoral del aspirante.<br><br>Pero si es para Ingenierías Nocturnas, Técnico Profesional en Mecatrónica, Medicina Veterinaria y Zootecnia, Tecnología en Atención Prehospitalaria, y las profesionalizaciones no requieren adjuntar documentos financieros."]}, 
    "legalizo mi matrícula" : {
				 "weight" : 1,
				 "responses" : ["vale, Al momento de ser admitido, cada aspirante debe escanear sus documentos de matrícula tanto académica como financiera y adjuntarlos a través del sistema de información en las fechas estipuladas y en el link que se habilite para este trámite.<br><br>Requisitos Académicos<br>Foto reciente 3x4 cm.<br>Copia del documento de identidad actualizado y por ambas caras, en caso de ser extranjero copia de la Cédula de Extranjería y Visa, también por ambas caras.<br>Haber presentado las pruebas ICFES.<br>Fotocopia del Acta de grado; si no se ha graduado, solicite constancia a su colegio donde certifique que cursa el grado 11, y la fecha de la ceremonia de grado; dos días después de la ceremonia debe presentar la fotocopia del acta de grado al Centro de Registro y Control Académico, sin pasarse de la fecha límite que se indica en el plegable de inscripciones para cada periodo académico, para cumplir con lo establecido en el artículo 4 item 1 del Reglamento Estudiantil vigente, de lo contrario pierde el derecho a la matrícula. Si es bachiller extranjero debe presentar Resolución de Convalidación de su título de Bachiller ante el Ministerio de Educación Nacional.<br>Fotocopia del carnet de la EPS o certificado de afiliación.<br><br>Esquema General de Vacunación (Obligatorio).<br>Carnet de vacunación que certifique las siguientes vacunas: BCG, Antipolio, DPT, Hepatitis B, Fiebre Amarilla, Influenza, Triple Viral y Varicela. En caso de no tener el carnet de las anteriores vacunas, diligenciar el acta de exclusión adjunta, si es menor de 18 años dicha acta debe venir firmada por sus padres o acudientes.<br><br>Requisitos Financieros<br>Fotocopia de la Declaración de Renta o del Certificado de ingresos y retenciones percibidos del año inmediatamente anterior (No se recibe certificado de no declarante, ni certificado de ingreso de un solo mes). (En caso de estar exento no es obligatorio).<br>Constancia del colegio original con el valor de la pensión mensual y certificar si es oficial o privado.<br>Fotocopia del último recibo de pago de servicios públicos domiciliarios cancelados donde conste el estrato social.<br>Si usted tiene algún hermano estudiando en esta Universidad debe adjuntar los registros civiles de cada uno.<br>Copia del certificado electoral del aspirante.<br><br>Pero si es para Ingenierías Nocturnas, Técnico Profesional en Mecatrónica, Medicina Veterinaria y Zootecnia, Tecnología en Atención Prehospitalaria, y las profesionalizaciones no requieren adjuntar documentos financieros."]}, 
    
    
    
    
    
    
    
     "Cuántos semestres" : {
				 "weight" : 1,
				 "responses" : ["El programa de Ingeniería Biomédica tiene 9 s emestres académicos."]}, 
    "cuantos semestres" : {
				 "weight" : 1,
				 "responses" : ["El programa de Ingeniería Biomédica tiene 9 s emestres académicos."]}, 
    
    
     "Cuántos créditos" : {
				 "weight" : 1,
				 "responses" : ["El programa de Ingeniería Biomédica tiene 9 s emestres académicos."]}, 
    
    
    "programas ofrece" : {
				 "weight" : 1,
				 "responses" : ["vale, en este momento se esta ofeciendo ingeniera de sistemas."]}, 
     "carreras ofrece" : {
				 "weight" : 1,
				 "responses" : ["vale, en este momento se esta ofeciendo ingeniera de sistemas."]}, 
    "oferta academica" : {
				 "weight" : 1,
				 "responses" : ["vale, en este momento se esta ofeciendo ingeniera de sistemas."]}, 
    "programas academicos" : {
				 "weight" : 1,
				 "responses" : ["vale, en este momento se esta ofeciendo ingeniera de sistemas."]}, 
    
     "puntaje requiero": {
				 "weight" : 1,
				 "responses" : ["OK, La Universidad no tiene un puntaje establecido, la admisión se realiza mediante los criterios de selección publicados en el Portal Web."]}, 
     "puntaje necesito": {
				 "weight" : 1,
				 "responses" : ["OK, La Universidad no tiene un puntaje establecido, la admisión se realiza mediante los criterios de selección publicados en el Portal Web."]}, 
    
     "inscribo": {
				 "weight" : 1,
				 "responses" : ["vale, a."]}, 
     "cuales requisitos" : {
				 "weight" : 1,
				 "responses" : ["vale, b."]},
    "que requisitos" : {
				 "weight" : 1,
				 "responses" : ["vale, c."]},
     "pago de matricula" : {
				 "weight" : 1,
				 "responses" : ["vale, una vez se encuentre en el Portal de la Universidad, se ubica en la pestaña Aspirantes opción RECIBOS DE PAGO de MATRICULA y despues de imprimir el recibo correspondiente se realiza la consigna en el banco."]},
     "pago de la matricula" : {
				 "weight" : 1,
				 "responses" : ["vale, una vez se encuentre en el Portal de la Universidad, se ubica en la pestaña Aspirantes opción RECIBOS DE PAGO de MATRICULA y despues de imprimir el recibo correspondiente se realiza la consigna en el banco."]},
    
    "puedo inscribirme" : {
				 "weight" : 1,
				 "responses" : ["La inscripción la puedes realizar desde cualquier sitio ingresando desde un computador con acceso a internet a www.curn.edu.co. Una vez diligencies el formato de inscripción, te permitirá descargar el volante de pago por valor de el pago de los derechos se puede realizar en cualquier sucursal del Banco de Bogotá. La entrega del formulario de inscripción y documentos requeridos se realiza en la oficina de admisiones."]},
     "alguien inscribirme": {
				 "weight" : 1,
				 "responses" : ["Sí, siempre y cuando tenga todos los datos y documentos requeridos para formalizar la inscripción."]}, 
     "inscripcion en solo dia": {
				 "weight" : 1,
				 "responses" : ["Sí, siempre y cuando te encuentres en Cartagena y tengas a la mano todos los datos y documentación requerida. Debes dirigirte a la sede administrativa (Tesorería) a reportar el pago de tu inscripción."]},
	
	
	
	"pagar la inscripcion": {
				 "weight" : 1,
				 "responses" : ["Sí, siempre y cuando te encuentres en Cartagena. Debes dirigirte a la sede administrativa (Tesorería) a realizar el respectivo pago."]}, 
	"pagar mi inscripción": {
				 "weight" : 1,
				 "responses" : ["Sí, siempre y cuando te encuentres en Cartagena. Debes dirigirte a la sede administrativa (Tesorería) a realizar el respectivo pago."]}, 
	
	
	
	
	
    
    
    "gracias" : {
				 "weight" : 1,
				 "responses" : ["Fue un gusto :)"]},
    "amable" : {
				 "weight" : 1,
				 "responses" : ["gracias por tu sinceridad!!!"]},
    "chao" : {
				 "weight" : 1,
				 "responses" : ["vale, adios ;)"]},
    "bye" : {
				 "weight" : 1,
				 "responses" : ["vale, bye, pasala bien!!!!."]},
    
      
   "buen dia" : {
				 "weight" : 1,
				 "responses" : ["Gracias, lo mismo, pasala bien!!!!."]},
     "feliz dia" : {
				 "weight" : 1,
				 "responses" : ["Gracias, lo mismo, pasala bien!!!!."]},
    
     "buena tarde" : {
				 "weight" : 1,
				 "responses" : ["Gracias, lo mismo, feliz resto de tarde!!."]},
    "feliz tarde" : {
				 "weight" : 1,
				 "responses" : ["Gracias, lo mismo, feliz resto de tarde!!."]},
    
    "buena noche" : {
				 "weight" : 1,
				 "responses" : ["Gracias, lo mismo, feliz noche!!!."]},
    "feliz noche" : {
				 "weight" : 1,
				 "responses" : ["Gracias, lo mismo, feliz noche!!!."]},
    
    "buenos dias" : {
				 "weight" : 1,
				 "responses" : ["Muy buenos días, si tienes alguna inquietud sobre nuestras carreras o admisiones con gusto podre ayudarte."]},
     "buenas tardes" : {
				 "weight" : 1,
				 "responses" : ["Muy buenas tardes, si tienes alguna inquietud sobre nuestras carreras o admisiones con gusto podre ayudarte."]},
    "buenas noches" : {
				 "weight" : 1,
				 "responses" : ["Muy buenas noches, si tienes alguna inquietud sobre nuestras carreras o admisiones con gusto podre ayudarte."]}
    
    
    
    
    
    
    
    

	
};

/*
 * Limits the number of duplicate in the responses that
 * have different keywords.
 */
var synonyms = {
	"sorry" : [
		"apologise"
	],
	"another language" : [
		"deutsch",
		"francais",
		"french",
		"italiano",
		"italian",
		"espanol",
		"spanish",
		"xforeign"
	],
	"dreamed" : [
		"dream",
		"dreams"
	],
	"i am" : [
		"am i",
		"im",
		"i'm"
	],
	"you" : [
		"you're",
		"you are"
	],
	"was i" : [
		"i was"
	]
};
/*
 * List of special case
 * 
 * "i am *1-3* happy" -> "i am happy"
 *
 * Ex.
 * User> I am extremely happy
 * this becomes "I am happy"
 * Eliza> Why are you happy?
 * 
 * Ex.
 * User> I am sad because i wish i was happy
 * This is changed because the 1-3 represents this
 * is valid if there is 1 to 3 words between "am" and
 * "happy"
 */
var responsesWithWildcard = {
	"i am *1-3* happy" : {	
							weight : 50,
							replacementWord : "estoy feliz"
						},
	"i am *1-3* sad" : {	
							weight : 50,
							replacementWord : "estoy triste"
						},
	"i am *1-3* bored" : {	
							weight : 50,
							replacementWord : "estoy aburrido"
						}
	
};


var initialMessages = ["Hola, muy buen dia!!! Me llamo Juliana y estoy aqui para resolver tus dudas ;)"];
//var initialMessages = ["Hi there, welcome to my office. I'm here to chat about anything. What's on your mind?", "How do you do. Please tell me your problem.","Please tell me what's been bothering you.", "Is something troubling you?", "Hello. How are you doing today?"];
var endChatTerms = ["adios ;).","ten buen dia.","pasala bien.","chao.","bye, pasala bien!!!!."];
var chatHistory = [];
var keywords = [];
var conversationOver = false;
var usedResponses = [];


/*
 * Initial function to start the coversation with
 * Eliza. This decides the initial message.
 *
 * Adds response keywords and synonyms with weight.
 * Sorts the responses by weight so the more important
 * meaningful is found first.
 */
function startElizaChat(){
	
	//sorts keywords (keywords and similar word) into array based on weight.
	getKeywordsByWeight();


	var initialMessage = initialMessages[Math.floor(Math.random()*initialMessages.length)];
	chatHistory.push({ isEliza : true, content : initialMessage });
	displayChat();

}
/*
 * This function does what it kind of says above.
 * It finds all of the response keywords and their
 * weight. Then finds all of the similar words and
 * their weight (based on response keywords). Then
 * it sorts the whole list.
 * 
 * This function can be more efficient.
 */
function getKeywordsByWeight(){
	var weights = [];
	var tempKeywords = [];
	//Adds responses
	for(var responseKeyword in responses){
		var weight = responses[responseKeyword].weight;
		tempKeywords[responseKeyword] = weight;

		if(!weights.includes(weight)){
			weights.push(weight);
		}
	}

	
	//Add similar words
	for(var wordWithResponse in synonyms){
		if(wordWithResponse in tempKeywords){
			var weight = tempKeywords[wordWithResponse];

			for(var i = 0;i < synonyms[wordWithResponse].length;i++){
				var similarWord = synonyms[wordWithResponse][i];
				tempKeywords[similarWord] = weight;
			}
		}//otherwise ignores it
	}

	//Adds responsesWithWildcard
	for(var word in responsesWithWildcard){
		var weight = responsesWithWildcard[word].weight;

		if(!weights.includes(weight)){
			weights.push(weight);
		}
		
		tempKeywords[word] = weight;
	}

	//Sorts them based on weight going from highest to lowest
	weights = weights.sort(sortNumber);
	
	//Populates keywords for final result to be used throughout
	for(var i = 0;i < weights.length;i++){
		var weight = weights[i];
		for(var word in tempKeywords){
			//NOT FOUND is the fallback word. So if it loops through all
			//and none match it will be this word.
			if(tempKeywords[word] === weight && word != "NOTFOUND"){
				var obj = {};
				obj.word = word;
				obj.weight = weight;

				keywords.push(obj);
			}
		}
	}
}
/*
 * SendElizaNewMessage is a function used for a one input, and one response
 * output. The idea is; here is where it gets the output from analyze but
 * this function manipulates the UI.
 */
function sendElizaNewMessage(newMessage){
	
	//Add to UI
	chatHistory.push({ isEliza : false, content : newMessage });
	displayChat();
	clearSendTextbox();

	if(!conversationOver){
		//Makes it lower case
		newMessage = processInput(newMessage);
		//Find the response based on the input. Check the analyze docs
		var response = analyze(newMessage);
	}else{
		var response = "Tu conversacion ha terminado. reinicia la conversacion refrescando la pagina.";
	}

	//Shows the reply from Eliza. To make it seem more real, takes a
	//random short time to response. Reloads the chat.
	setTimeout(function(){
		usedResponses.push(response);
		chatHistory.push({ isEliza : true, content : response });
		displayChat();
	}, determineResponseTime());

}
/*
 * Analyze is Eliza's main function get a response based on
 * user's current input. It also takes in consideration the
 * past messages, and a responses user/client engagement.
 */
function analyze(newMessage){
	var found = false;
	var response = '';

	//Check all
	for (var i = 0;i < keywords.length;i++) {
		var word = keywords[i].word;
		
		if(endChatTerms.contains(newMessage)){
			conversationOver = true;
			newMessage = "goodbye";
		}

		//Check for a wild card in the keyword
		//If yes then its a keyword with an adjective like "i am *1-3* happy"
		//Also checks if the newMessage contains all parts in proper order and following
		//the rules
		if(word.indexOf("*") != -1 && containsKeywordWithWildcard(newMessage, word) && !found){
			
			response = selectResponse(findBasicKeywordFromKeywordWithWildcard(word));
			found = true;

		}else if((newMessage.indexOf(word) != -1 && newMessage.length == word.length || newMessage.indexOf(word + " ") != -1 || newMessage.indexOf(" " + word) != -1) && !found){
			//Check to see if the keyword is in the sentence
			//Ex. input is "Hi" or "This and more" or "Hi doc!"
			
			//This picks a response
			response = selectResponse(word);
			
			//Check for wild card
			found = true;

		}
		

		if(found && response.indexOf("*") !== -1){
				//Wild card exists so sub in the phrase
				//Ex. I had a dream about my dog.
				//Dream is the keyword
				

				//Right of the keyword in the incoming message
				var remainingInput = newMessage.substring(newMessage.indexOf(word) + word.length+1, newMessage.length);
				//RemainingInput: [about my dog]
				
				//Right of the wildcard in the response
				var rightOfWildcardInResponse = response.substring(response.indexOf("*")+1);
				//Right of Wildcard In Response: [ while you were awake?]

				//Start of the response to the wildcard
				var startOfResponseToWildcard = response.substring(0, response.indexOf("*"));
				//Start of response to wildcard: [Have you ever fantasized]

				//The start of the remainingInput to the end minus the one character
				var startOfInputMinusOneCharacter = remainingInput.substring(0, remainingInput.length-1);
				//Start of input minus one character: [about my do]

				//This is remaining of the remaining input.
				//Regular expression replaces things that are not either A-Z or a-z
				var remainingOfInputOnRight = remainingInput.substring(remainingInput.length-1, remainingInput.length).replace("[^A-Za-z]","");
				//Remaining of Input on Right: [g]


				response =  startOfResponseToWildcard + replaceWords(startOfInputMinusOneCharacter + remainingOfInputOnRight) + rightOfWildcardInResponse;
				//Response: Have you ever fantasized about my dog while you were awake?

				//Changes the words and fixes the tenses.
				//Ex. I had a dream about my dog. --> Have you ever fantasized about your dog while you were awake?
				//But it only should work on the input not the response so you apply it to the inner parts.
		}
		if(found){
			break;
		}
		

	}

	if(!found){
		response = responses["NOTFOUND"].responses[Math.floor(Math.random()*responses["NOTFOUND"].responses.length)];
	}

	return response;
}
/*
 * Selects one of the responses based on a few things:
 * - Random (so responses aren't consistant)
 * - if contains wild card
 * - The responses passed in hold the highest value
 * - Checks if the response has been used already
 * 
 * I decided to add an additional(duplicate) response
 * instead of removing because I dont know how long the
 * conversation will go on for.
 *
 * Reason for creating a second array instead of manipulating
 * the existing one was because of a bug where it would
 * duplicate the duplicate.
 */
function selectResponse(word){
	var potentialResponses = [];
	if(word in responses){
		//Easily find responses by using key value pairing
		potentialResponses = responses[word];
	}else{
		//Need to find the related responses
		potentialResponses = findResponsesForSimilarWord(word);
	}

	
	var newResponses = [];
	var originalResponsesSize = potentialResponses.responses.length;


	for(var i = 0;i < originalResponsesSize;i++){
		newResponses.push(potentialResponses.responses[i]);

		//If has wild card, adds another
		if(potentialResponses.responses[i].indexOf("*") !== -1){
			newResponses.push(potentialResponses.responses[i]);
		}

		//If the response hasnt been used
		if(!usedResponses.contains(potentialResponses.responses[i])){
			newResponses.push(potentialResponses.responses[i]);
		}
	}
	return newResponses[Math.floor(Math.random()*newResponses.length)];
}
/*
 * Process input by making input lower case
 * and remove unnessary punctuation. 
 */
function processInput(message){
	message = message.toLowerCase();
	message = removePunctuation(message);
	return message;
}
/*
 * Replaces the context of words, flipping
 * the voice from the user to eliza.
 * 
 * It's split into an array so it doesn't
 * replace back and forth. Ex. me->i i->me
 */
function replaceWords(input){
	
	var wordsForReplacement = [];
	wordsForReplacement["yo"] = "tu";
	wordsForReplacement["tu"] = "yo";
	wordsForReplacement["mi"] = "tu";
	wordsForReplacement["mis"] = "tuyos";
	wordsForReplacement["soy"] = "eres";
	wordsForReplacement["eres"] = "soy";
	wordsForReplacement["fui"] = "fueron";
	wordsForReplacement["yo no"] = "tu no";
	wordsForReplacement["yo tengo"] = "tu tienes";
	wordsForReplacement["yo tendre"] = "tu tendras";
	wordsForReplacement["usted tiene"] = "yo tengo";
	wordsForReplacement["tu tendrás"] = "yo tendre";
	wordsForReplacement["tuyo"] = "mio";
	wordsForReplacement["tuyos"] = "mios";
	wordsForReplacement["mi"] = "tu";
	//Added in after testing
	wordsForReplacement["siempre estuvo"] = "siempre tuvo";
	
	
	var inputSplit = input.split(" ");

	//Was having an overrite issue
	var newSplit = [];
	for(var i = 0;i < inputSplit.length;i++){
		var currentInputWord = inputSplit[i];
		if(currentInputWord in wordsForReplacement){
			var replacementWord = wordsForReplacement[currentInputWord];
			newSplit[i] = replacementWord;

			//I had a dream about my dog.
		}else{
			newSplit[i] = currentInputWord;
		}
	}

	var updatedMessage = "";
	for(var i = 0;i < newSplit.length;i++){
		var word = newSplit[i];
		if(updatedMessage != ""){
			updatedMessage += " ";
		}
		updatedMessage += word;
	}

	return updatedMessage;
}

/*
 * Removes basic punctuation from the
 * user input message.
 */
function removePunctuation(message){
	//',;.?!:'
	message = message.replace(",","");
	message = message.replace(";","");
	message = message.replace(".","");
	message = message.replace("?","");
	message = message.replace("!","");
	message = message.replace(":","");
	
	
	return message;
}

/*
 * Randomly generate a response time
 */
function determineResponseTime(){
	var m = Math.floor(Math.random() * 5000) + 3000;
	return m;
}
/*
 * Taken from: http://stackoverflow.com/questions/1063007/how-to-sort-an-array-of-integers-correctly
 * modified by Keith Weaver
 */
function sortNumber(a,b) {
    return b - a;
}

/*
 * Used to find the responses for similar words.
 * Looks up the key of the similar word. Then
 * fetches the responses.
 */
function findResponsesForSimilarWord(word){
	var foundKey = "";
	for(var key in synonyms){
		var similarWords = synonyms[key];
		for(var i = 0;i < similarWords.length;i++){
			if(similarWords[i] == word){
				foundKey = key;
				break;
			}
		}
		if(foundKey != ""){
			break;
		}
	}

	//Find responses for that key
	return responses[foundKey];
}

/*
 * Checks to see if the keyword exists properly 
 * so "I am happy" is in proper order. Also 
 * checks to against runs so only so many words
 * are between "am" and "happy". So
 * "I am extremely happy" but 
 * "I am sad because I am happy" would fail.
 */
function containsKeywordWithWildcard(input, keywordsWithWildcardStr){
	
	var responseWildcardObj = getResponseWildcardInfo(keywordsWithWildcardStr);

	var numberOfWordsInWildcard = 0;
	var foundKeywords = 0;
	var inputArray = input.split(" ");
	for(var i = 0;i < inputArray.length;i++){
		var currentWord = inputArray[i];
		
		//if the word is not a keyword, add it. and we are in the wildcard
		if((foundKeywords >= responseWildcardObj.minNumWords && foundKeywords <= responseWildcardObj.maxNumWords) && !responseWildcardObj.keywords.contains(currentWord)){
			numberOfWordsInWildcard++;
		}

		if(responseWildcardObj.keywords.length > 0 && currentWord == responseWildcardObj.keywords[0]){
			//so first this would be "i" for ["i","am","happy"]
			responseWildcardObj.keywords.remove(currentWord);
			foundKeywords++;
		}
	}

	//Doesnot have all keywords
	//"I am * sad"
	//"I am * happy"
	//> I am extremely happy
	//Sad should stop here cause its not valid
	if(responseWildcardObj.keywords.length > 0){
		//console.log("Not the correct keyword");
		return false;
	}
	if(!(numberOfWordsInWildcard >= responseWildcardObj.minNumWords && numberOfWordsInWildcard <= responseWildcardObj.maxNumWords)){
		//console.log("Does not follow wildcard rules");
		return false;
	}
	
	return true;
}

/*
 * Find the replacement word so "I am extremely happy" would return "I am happy"
 */
function findBasicKeywordFromKeywordWithWildcard(keywordsWithWildcardStr){
	var t =  responsesWithWildcard[keywordsWithWildcardStr].replacementWord;
	console.log("Replacement:" + t);
	return t;
}

/*
 * Creates an object about the response replacement.
 * It breaks the keywords in an array. With the position
 * of the word before the wildcard and the position of
 * the word after the wildcard. Also with the max and min
 * number of words.
 */
function getResponseWildcardInfo(keywordsWithWildcardStr){
	var keywordsWithWildcard = keywordsWithWildcardStr.split(" ");
	
	var rulesInSingleStr = "";
	var positionOfWordBeforeOfWildcard = 0;
	var positionOfWordAfterOfWildcard = 0;
	for(var i = 0;i < keywordsWithWildcard.length;i++){
		var str = keywordsWithWildcard[i];
		
		positionOfWordAfterOfWildcard = i;
		//gets the position of wild card
		//since its going to be removed, we know
		//this is where the word "happy" should be

		if(str.indexOf("*") != -1){
			rulesInSingleStr = str;
			break;
		}
	}
	positionOfWordBeforeOfWildcard = positionOfWordAfterOfWildcard-1;


	//["i","am","*1-3*","happy"]
	keywordsWithWildcard = keywordsWithWildcard.remove(rulesInSingleStr);
	//["i","am","happy"]
	rulesInSingleStr = rulesInSingleStr.replace("*","").replace("*","");//*1-3* --> 1-3
	if(rulesInSingleStr.length < 3){
		return false;
	}
	//Now know the upper and lower bounds for the number of accepted words in the wildcard
	var minNumWords = rulesInSingleStr.substring(0,1);
	var maxNumWords = rulesInSingleStr.substring(2);
	

	var obj = {
		minNumWords : minNumWords,
		maxNumWords : maxNumWords,
		wordBeforeWildcard : positionOfWordBeforeOfWildcard,
		wordAfterWildcard : positionOfWordAfterOfWildcard,
		keywords : keywordsWithWildcard
	};


	return obj;
}
/*
 * Taken from: http://stackoverflow.com/questions/5767325/how-to-remove-a-particular-element-from-an-array-in-javascript
 * Modified
 */
Array.prototype.remove = function ( needle ) {
	var index = this.indexOf(needle);
	
	if(index > -1){
		this.splice(index, 1);
		return this;
	}
	return this;
}
/*
 * Taken from: http://stackoverflow.com/questions/12623272/how-to-check-if-a-string-array-contains-one-string-in-javascript
 */
Array.prototype.contains = function ( needle ) {
   for (i in this) {
      if (this[i] == needle) return true;
   }
   return false;
}
